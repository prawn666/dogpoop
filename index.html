<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>–ö–æ–º–ø–∞—Å</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; }
    button { font-size: 20px; padding: 15px 30px; }
    #status { margin-top: 20px; color: green; }
  </style>
</head>
<body>
  <h1>üìç –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–ø–∞—Å–∞</h1>
  <p id="angle">–£–≥–æ–ª: –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω</p>
  <button onclick="requestHeading()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–ø–∞—Å</button>
  <p id="status"></p>

  <script>
    let lastHeading = null;

    function sendHeading(heading) {
      const chatId = '407378418';
      const token = '8037753739:AAHNpW7v7g2hbTdNdV9KANmAjM09IWl9xMY';
      const url = `https://api.telegram.org/bot${token}/sendMessage`;

      const text = `üìç Heading: ${heading}¬∞`;
      fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id: chatId, text })
      }).then(r => {
        document.getElementById('status').textContent = '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!';
      }).catch(e => {
        document.getElementById('status').textContent = '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏';
      });
    }

    function requestHeading() {
      if (typeof DeviceOrientationEvent !== 'undefined' &&
          typeof DeviceOrientationEvent.requestPermission === 'function') {
        // iOS (>=13) —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
        DeviceOrientationEvent.requestPermission().then(response => {
          if (response === 'granted') {
            window.addEventListener('deviceorientation', handleOrientation);
          } else {
            alert('–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ');
          }
        }).catch(console.error);
      } else {
        // Android / —Å—Ç–∞—Ä—ã–µ iOS
        window.addEventListener('deviceorientation', handleOrientation);
      }
    }

function handleOrientation(event) {
  let heading;
  
  if (event.webkitCompassHeading !== undefined) {
    // iOS Safari
    heading = event.webkitCompassHeading; 
  } else {
    // fallback
    heading = 360 - event.alpha; 
  }

  if (heading != null) {
    lastHeading = Math.round(heading);
    document.getElementById('angle').textContent = `–£–≥–æ–ª: ${lastHeading}¬∞`;
    sendHeading(lastHeading);
    window.removeEventListener('deviceorientation', handleOrientation);
  } else {
    document.getElementById('status').textContent = '–ö–æ–º–ø–∞—Å –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
  }
}
  </script>
</body>
</html>

